<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mobile Select Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="src/css/style.css">
    <style>
        body {
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .test-info h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .test-info p {
            margin: 0;
            color: #424242;
            font-size: 14px;
        }
        
        .test-status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Simulazione mobile forzata */
        @media (max-width: 767px) {
            .test-container {
                margin: 10px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">
            <h3>üîß Test Fix Mobile Select</h3>
            <p>
                <strong>Problema:</strong> Il modal delle custom select si chiude appena si tocca su mobile.<br>
                <strong>Fix implementato:</strong> Eventi overlay migliorati + propagazione corretta.<br>
                <strong>Test:</strong> Tocca la select sotto e prova a scrollare le opzioni senza che si chiuda.
            </p>
        </div>
        
        <form>
            <div class="mb-3">
                <label for="test-select" class="form-label">Select di Test (Mobile)</label>
                <select 
                    class="form-select" 
                    id="test-select" 
                    data-custom="true" 
                    data-label="Opzione Test"
                    required
                >
                    <option value="">Seleziona un'opzione...</option>
                    <option value="opzione1">Opzione 1 - Prima opzione di test</option>
                    <option value="opzione2">Opzione 2 - Seconda opzione di test</option>
                    <option value="opzione3">Opzione 3 - Terza opzione di test</option>
                    <option value="opzione4">Opzione 4 - Quarta opzione di test</option>
                    <option value="opzione5">Opzione 5 - Quinta opzione di test</option>
                    <option value="opzione6">Opzione 6 - Sesta opzione di test</option>
                    <option value="opzione7">Opzione 7 - Settima opzione di test</option>
                    <option value="opzione8">Opzione 8 - Ottava opzione di test</option>
                    <option value="opzione9">Opzione 9 - Nona opzione di test</option>
                    <option value="opzione10">Opzione 10 - Decima opzione di test</option>
                    <option value="opzione11">Opzione 11 - Undicesima opzione di test</option>
                    <option value="opzione12">Opzione 12 - Dodicesima opzione di test</option>
                    <option value="opzione13">Opzione 13 - Tredicesima opzione di test</option>
                    <option value="opzione14">Opzione 14 - Quattordicesima opzione di test</option>
                    <option value="opzione15">Opzione 15 - Quindicesima opzione di test</option>
                </select>
            </div>
            
            <div id="test-result" class="test-status status-pending">
                ‚è≥ In attesa di test... Tocca la select sopra per testarla su mobile.
            </div>
        </form>
        
        <div style="margin-top: 20px; font-size: 12px; color: #666;">
            <strong>Istruzioni test:</strong><br>
            1. Tocca la select sopra per aprire il modal<br>
            2. Prova a scrollare le opzioni con il dito<br>
            3. Il modal NON deve chiudersi durante lo scroll<br>
            4. Deve chiudersi solo toccando fuori dalle opzioni<br>
            5. Selezionare un'opzione deve funzionare correttamente
        </div>
    </div>

    <!-- Scripts -->
    <script src="src/js/components/CustomSelect.js"></script>
    <script>
        // Simula il logger se non presente
        if (!window.appLogger) {
            window.appLogger = {
                debug: (msg, data) => console.log('DEBUG:', msg, data),
                info: (msg, data) => console.log('INFO:', msg, data),
                warn: (msg, data) => console.warn('WARN:', msg, data),
                error: (msg, data) => console.error('ERROR:', msg, data)
            };
        }
        
        // Inizializza le select quando il DOM √® pronto
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Inizializzazione custom selects...');
            
            // Inizializza la select di test
            const testSelect = document.getElementById('test-select');
            if (testSelect) {
                try {
                    testSelect.customSelectInstance = new CustomSelect(testSelect);
                    console.log('Custom select inizializzata con successo');
                    
                    // Monitor eventi per test
                    testSelect.addEventListener('change', function(e) {
                        const resultDiv = document.getElementById('test-result');
                        resultDiv.className = 'test-status status-success';
                        resultDiv.innerHTML = `‚úÖ Test SUPERATO! Valore selezionato: "${e.target.value}"`;
                    });
                    
                    // Test apertura modal
                    const customWrapper = testSelect.parentElement.querySelector('.custom-select-wrapper');
                    if (customWrapper) {
                        const trigger = customWrapper.querySelector('.custom-select-trigger');
                        if (trigger) {
                            trigger.addEventListener('click', function() {
                                setTimeout(() => {
                                    const modal = document.querySelector('.custom-select-mobile-modal');
                                    if (modal && window.innerWidth <= 767) {
                                        const resultDiv = document.getElementById('test-result');
                                        resultDiv.className = 'test-status status-pending';
                                        resultDiv.innerHTML = 'üì± Modal aperto! Ora prova a scrollare le opzioni senza che si chiuda...';
                                    }
                                }, 100);
                            });
                        }
                    }
                    
                } catch (error) {
                    console.error('Errore inizializzazione:', error);
                    const resultDiv = document.getElementById('test-result');
                    resultDiv.className = 'test-status status-error';
                    resultDiv.innerHTML = `‚ùå Errore inizializzazione: ${error.message}`;
                }
            }
        });
        
        // Debug info
        console.log('Test page loaded');
        console.log('Window width:', window.innerWidth);
        console.log('Is mobile?', window.innerWidth <= 767);
    </script>
</body>
</html>
