<!DOCTYPE html>
<html lang="it">
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestione Pazienti</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-50: #e3f2fd; --primary-100: #bbdefb; --primary-500: #2196f3; --primary-600: #1976d2;
      --primary-700: #1565c0; --error-50: #ffebee; --error-600: #e53935; --gray-50: #fafafa;
      --gray-300: #e0e0e0; --gray-600: #757575; --surface: #ffffff; --on-surface: #1c1b1f;
      --elevation-2: 0 1px 2px 0 rgba(0,0,0,0.3), 0 2px 6px 2px rgba(0,0,0,0.15);
      --elevation-4: 0 6px 10px 4px rgba(0,0,0,0.15), 0 2px 3px 0 rgba(0,0,0,0.3);
      --border-radius-md: 8px; --border-radius-lg: 12px; --border-radius-xl: 16px;
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    * { box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; margin: 0; background: var(--gray-50); min-height: 100vh; color: var(--on-surface); }
    .app-header { background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%); color: white; padding: 12px 24px; box-shadow: var(--elevation-2); position: fixed; top: 0; left: 0; right: 0; z-index: 100; }
    .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .header-title { display: flex; align-items: center; gap: 16px; margin: 0; font-size: 1.25rem; font-weight: 600; cursor: pointer; }
    .user-info { display: flex; align-items: center; gap: 12px; font-size: 0.9rem; }
    .user-email { font-weight: 500; }
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 8px 16px; border: none; border-radius: var(--border-radius-md); font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: var(--transition-fast); text-decoration: none; }
    .btn-primary { background: var(--primary-500); color: white; }
    .btn-primary:hover { background: var(--primary-600); }
    .logout-btn { background: none; border: 1px solid rgba(255,255,255,0.5); color: white; }
    .logout-btn:hover { background: rgba(255,255,255,0.1); }
    .main-container { padding-top: 80px; }
    .view { display: none; padding: 24px; max-width: 1000px; margin: 0 auto; }
    .view.active { display: block; }
    .card { background: var(--surface); border-radius: var(--border-radius-xl); box-shadow: var(--elevation-4); padding: 24px 40px; margin-bottom: 24px; }
    .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .menu-btn { display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 24px; border-radius: var(--border-radius-lg); font-size: 1.1rem; font-weight: 500; text-decoration: none; background: var(--primary-50); color: var(--primary-700); text-align: center; }
    .menu-btn:hover { background: var(--primary-100); transform: translateY(-2px); box-shadow: var(--elevation-2); }
    .menu-btn .material-icons { font-size: 36px; }
    .loading-container { text-align: center; padding: 40px; }
    .loading-spinner { width: 30px; height: 30px; border: 3px solid var(--primary-100); border-top: 3px solid var(--primary-500); border-radius: 50%; animation: spin 1s linear infinite; display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .auth-prompt { text-align: center; padding: 40px; }
    .form-group { margin-bottom: 1rem; }
    .form-label { display: block; margin-bottom: .5rem; font-weight: 500; }
    .form-input, .form-select { width: 100%; padding: 12px; border: 2px solid var(--gray-300); border-radius: var(--border-radius-md); font-size: 1rem; }
    .form-actions { margin-top: 1.5rem; text-align: center; }
    .alert { padding: 1rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .25rem; }
    .alert-success { color: #0f5132; background-color: #d1e7dd; border-color: #badbcc; }
    .alert-danger { color: #842029; background-color: #f8d7da; border-color: #f5c2c7; }
    .alert-info { color: #055160; background-color: #cff4fc; border-color: #b6effb; }
    .alert-secondary { color: #41464b; background-color: #e2e3e5; border-color: #d3d6d8; }
    .d-flex { display: flex; }
    .align-items-center { align-items: center; }
    .ms-2 { margin-left: .5rem; }
    .mt-3 { margin-top: 1rem; }
    .loading-spinner-small { width: 20px; height: 20px; border: 2px solid var(--primary-100); border-top: 2px solid var(--primary-500); border-radius: 50%; animation: spin 1s linear infinite; }
  </style>
</head>
<body>

  <header class="app-header">
    <div class="header-content">
      <h1 id="home-button" class="header-title"><span class="material-icons">local_hospital</span> Gestione Pazienti</h1>
      <div id="auth-container"></div>
    </div>
  </header>

  <main id="app-container" class="main-container">
    <!-- Viste dell'applicazione -->
  </main>

  <!-- Template per le viste -->
  <template id="auth-template-login">
    <button id="login-button" class="btn btn-primary"><span class="material-icons">login</span> Accedi con Google</button>
  </template>

  <template id="auth-template-logout">
    <div class="user-info">
      <span id="user-email" class="user-email"></span>
      <button id="logout-button" class="btn logout-btn">Logout</button>
    </div>
  </template>

  <template id="view-home">
    <div class="view card">
      <h2>Menu Principale</h2>
      <div class="menu-grid">
        <!-- Il menu verrà generato dinamicamente da app.js -->
      </div>
    </div>
  </template>

  <template id="view-grafico">
    <div class="view">
      <h2>Grafico Diagnosi</h2>
      <div class="card">
        <!-- Contenuto del grafico qui -->
        <div id="chart-container" style="min-height: 400px;"></div>
      </div>
    </div>
  </template>

  <template id="view-inserimento">
    <div class="view">
      <h2>Inserimento Paziente</h2>
      <div class="card">
        <div class="auth-prompt" style="display:none;">
          <p>Per inserire un nuovo paziente, devi prima accedere.</p>
        </div>
        <form id="form-inserimento" style="display:none;">
          
          <div class="form-group">
            <label for="nome" class="form-label">Nome</label>
            <input type="text" id="nome" name="nome" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="cognome" class="form-label">Cognome</label>
            <input type="text" id="cognome" name="cognome" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="dataRicovero" class="form-label">Data di Ricovero</label>
            <input type="date" id="dataRicovero" name="data_ricovero" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="diagnosi" class="form-label">Diagnosi</label>
            <input type="text" id="diagnosi" name="diagnosi" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="repartoAppartenenza" class="form-label">Reparto Appartenenza</label>
            <select id="repartoAppartenenza" name="reparto_appartenenza" class="form-select" required>
              <option value="">Seleziona reparto...</option>
              <option value="Ortopedia">Ortopedia</option>
              <option value="Chirurgia Arti">Chirurgia Arti</option>
              <option value="Plastica">Plastica</option>
            </select>
          </div>
          <div class="form-group">
            <label for="repartoProvenienza" class="form-label">Reparto Provenienza</label>
            <select id="repartoProvenienza" name="reparto_provenienza" class="form-select">
              <option value="">Seleziona provenienza...</option>
              <option value="AR">AR</option>
              <option value="PO">PO</option>
              <option value="CO">CO</option>
              <option value="CR">CR</option>
              <option value="PS">PS</option>
            </select>
          </div>
          <div class="form-group">
            <label for="livelloAssistenza" class="form-label">Livello Assistenza</label>
            <select id="livelloAssistenza" name="livello_assistenza" class="form-select" required>
              <option value="">Seleziona livello...</option>
              <option value="Bassa">Bassa</option>
              <option value="Media">Media</option>
              <option value="Alta">Alta</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Salva Paziente</button>
          </div>
        </form>
        <div id="messaggio-container" class="mt-3"></div>
      </div>
    </div>
  </template>

  <template id="view-dimissione">
    <div class="view">
      <h2>Dimissione Paziente</h2>
      <div class="card">
        <div class="auth-prompt" style="display:none;">
          <p>Per dimettere un paziente, devi prima accedere.</p>
        </div>
        <form id="form-dimissione" style="display:none;">
          <div class="form-group">
            <label for="paziente-select" class="form-label">Seleziona Paziente</label>
            <select id="paziente-select" class="form-select" required></select>
          </div>
          <div class="form-group">
            <label for="dataDimissione" class="form-label">Data di Dimissione</label>
            <input type="date" id="dataDimissione" class="form-input" required>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Dimetti Paziente</button>
          </div>
        </form>
      </div>
    </div>
  </template>

  <!-- Nuovi template per le viste mancanti -->
  <template id="view-tempo-media-degenza">
    <div class="view card"><h2>Tempo Medio Degenza</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-importa-csv">
    <div class="view card"><h2>Avvia Importazione CSV</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-crea-foglio-filtrato">
    <div class="view card"><h2>Crea Foglio Filtrato</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-aggiorna-foglio">
    <div class="view card"><h2>Aggiorna Foglio Attivo</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-formatta">
    <div class="view card"><h2>Applica Formattazione Standard</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-colori-alternati">
    <div class="view card"><h2>Applica Colori Alternati</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-copia-speciale">
    <div class="view card"><h2>Copia Senza Formattazione</h2><p>Funzionalità in costruzione.</p></div>
  </template>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="module" src="app.js"></script>

</body>
</html>