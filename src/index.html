<!DOCTYPE html>
<html lang="it">
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestione Pazienti</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  .alert.d-flex.align-items-center {
    display: flex;
    align-items: center;
}

.loading-spinner-small {
    width: 20px;
    height: 20px;
    border: 2px solid var(--primary-100);
    border-top: 2px solid var(--primary-500);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.mt-3 {
    margin-top: 1rem;
}

</head>
<body>

  <header class="app-header">
    <div class="header-content">
      <h1 id="home-button" class="header-title"><span class="material-icons">local_hospital</span> Gestione Pazienti</h1>
      <div id="auth-container"></div>
    </div>
  </header>

  <main id="app-container" class="main-container">
    <!-- Viste dell'applicazione -->
  </main>

  <!-- Template per le viste -->
  <template id="auth-template-login">
    <button id="login-button" class="btn btn-primary"><span class="material-icons">login</span> Accedi con Google</button>
  </template>

  <template id="auth-template-logout">
    <div class="user-info">
      <span id="user-email" class="user-email"></span>
      <button id="logout-button" class="btn logout-btn">Logout</button>
    </div>
  </template>

  <template id="view-home">
    <div class="view card">
      <h2>Menu Principale</h2>
      <div class="menu-grid">
        <!-- Il menu verrà generato dinamicamente da app.js -->
      </div>
    </div>
  </template>

  <template id="view-grafico">
    <div class="view">
      <h2>Grafico Diagnosi</h2>
      <div class="card">
        <!-- Contenuto del grafico qui -->
        <div id="chart-container" style="min-height: 400px;"></div>
      </div>
    </div>
  </template>

  <template id="view-inserimento">
    <div class="view">
      <h2>Inserimento Paziente</h2>
      <div class="card">
        <div class="auth-prompt" style="display:none;">
          <p>Per inserire un nuovo paziente, devi prima accedere.</p>
        </div>
        <form id="form-inserimento" style="display:none;">
          
          <div class="form-group">
            <label for="nome" class="form-label">Nome</label>
            <input type="text" id="nome" name="nome" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="cognome" class="form-label">Cognome</label>
            <input type="text" id="cognome" name="cognome" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="dataRicovero" class="form-label">Data di Ricovero</label>
            <input type="date" id="dataRicovero" name="data_ricovero" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="diagnosi" class="form-label">Diagnosi</label>
            <input type="text" id="diagnosi" name="diagnosi" class="form-input" required>
          </div>
          <div class="form-group">
            <label for="repartoAppartenenza" class="form-label">Reparto Appartenenza</label>
            <select id="repartoAppartenenza" name="reparto_appartenenza" class="form-select" required>
              <option value="">Seleziona reparto...</option>
              <option value="Ortopedia">Ortopedia</option>
              <option value="Chirurgia Arti">Chirurgia Arti</option>
              <option value="Plastica">Plastica</option>
            </select>
          </div>
          <div class="form-group">
            <label for="repartoProvenienza" class="form-label">Reparto Provenienza</label>
            <select id="repartoProvenienza" name="reparto_provenienza" class="form-select">
              <option value="">Seleziona provenienza...</option>
              <option value="AR">AR</option>
              <option value="PO">PO</option>
              <option value="CO">CO</option>
              <option value="CR">CR</option>
              <option value="PS">PS</option>
            </select>
          </div>
          <div class="form-group">
            <label for="livelloAssistenza" class="form-label">Livello Assistenza</label>
            <select id="livelloAssistenza" name="livello_assistenza" class="form-select" required>
              <option value="">Seleziona livello...</option>
              <option value="Bassa">Bassa</option>
              <option value="Media">Media</option>
              <option value="Alta">Alta</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Salva Paziente</button>
          </div>
        </form>
        <div id="messaggio-container" class="mt-3"></div>
      </div>
    </div>
  </template>

  <template id="view-dimissione">
    <div class="view">
      <h2>Dimissione Paziente</h2>
      <div class="card">
        <div class="auth-prompt" style="display:none;">
          <p>Per dimettere un paziente, devi prima accedere.</p>
        </div>
        <form id="form-dimissione" style="display:none;">
          <div class="form-group">
            <label for="paziente-select" class="form-label">Seleziona Paziente</label>
            <select id="paziente-select" class="form-select" required></select>
          </div>
          <div class="form-group">
            <label for="dataDimissione" class="form-label">Data di Dimissione</label>
            <input type="date" id="dataDimissione" class="form-input" required>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Dimetti Paziente</button>
          </div>
        </form>
      </div>
    </div>
  </template>

  <!-- Nuovi template per le viste mancanti -->
  <template id="view-tempo-media-degenza">
    <div class="view card"><h2>Tempo Medio Degenza</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-importa-csv">
    <div class="view card"><h2>Avvia Importazione CSV</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-crea-foglio-filtrato">
    <div class="view card"><h2>Crea Foglio Filtrato</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-aggiorna-foglio">
    <div class="view card"><h2>Aggiorna Foglio Attivo</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-formatta">
    <div class="view card"><h2>Applica Formattazione Standard</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-colori-alternati">
    <div class="view card"><h2>Applica Colori Alternati</h2><p>Funzionalità in costruzione.</p></div>
  </template>
  <template id="view-copia-speciale">
    <div class="view card"><h2>Copia Senza Formattazione</h2><p>Funzionalità in costruzione.</p></div>
  </template>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="module" src="app.js"></script>

</body>
</html>
